---
import { getCollection } from "astro:content";
import MainLayout from "../../layouts/MainLayout.astro";

export async function getStaticPaths({ paginate }) {
  const posts = await getCollection("news");

  // Sort newest first
  posts.sort(
    (a, b) => b.data.date.valueOf() - a.data.date.valueOf()
  );

  return paginate(posts, {
    pageSize: 5,
  });
}

const { page } = Astro.props;
---

<MainLayout title="News">
  <section class="news-list">
    {page.data.map((post) => (
      <article>
        <h2>
          <a href={`/news/${post.slug}/`}>
            {post.data.title}
          </a>
        </h2>
        <p class="date">
          {post.data.date.toLocaleDateString()}
        </p>
        <p class = excerpt>
	  {post.data.summary}
	</p>
      </article>
    ))}
  </section>

  <nav class="pagination">
    {page.url.prev && (
      <a href={page.url.prev}>← Newer</a>
    )}

    <span>
      Page {page.currentPage} of {page.lastPage}
    </span>

    {page.url.next && (
      <a href={page.url.next}>Older →</a>
    )}
  </nav>
</MainLayout>

